name: EmbedmdCheck

on:
  pull_request:
    branches:
      - azure_web_app

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Installing and Running embedmed
      run: |
        sudo apt install boxes
        go get github.com/campoy/embedmd
        cd docs/chaos-engineering/chaos-faults
        embedmd -w $(find **/*.md)
      continue-on-error: true

    - name: embedmd check
      run: |
        export TERM=xterm-256color
        count=$(git status -s| wc -l)
        if [ "$count" -ne "0" ]
        then
          tput setaf 1; echo "Error: embedmd check failed"
          tput setaf 4; echo "Please check the following files need an embedmd run:"
          output=$(git status -s)
          echo "$output" | boxes -d stone -p a2v1
          tput setaf 3; echo "Please follow the instructions to run embedmd:"
          tput setaf 3; echo "cd docs/chaos-engineering/chaos-faults"
          tput setaf 3; echo "embedmd -w \$(find **/*.md)"
          exit 1
        else
          tput setaf 2; echo "Nothing to embed"
        fi
      shell: sh
